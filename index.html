<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞–≥–∞–∑–∏–Ω Telegram</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f2f4f8; }
    header { padding: 16px; background: #4a90e2; color: white; font-size: 20px; text-align: center; }
    .tabs { display: flex; overflow-x: auto; background: #fff; padding: 10px; }
    .tab { padding: 10px 20px; margin-right: 10px; border-radius: 20px; background: #eee; cursor: pointer; white-space: nowrap; }
    .tab.active { background: #4a90e2; color: #fff; }
    .container { padding: 20px; display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
    .card { background: white; border-radius: 12px; padding: 10px; width: 150px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
    .card img { width: 100px; height: 100px; object-fit: contain; }
    .card .name { font-size: 14px; margin: 5px 0; }
    .card .price { font-weight: bold; color: #333; margin-bottom: 8px; }
    .btn { background: #4a90e2; color: white; border: none; padding: 6px 10px; border-radius: 6px; font-size: 13px; cursor: pointer; }
    .footer { text-align: center; margin: 20px; }
  </style>
</head>
<body>
  <header>üõç Telegram –ú–∞–≥–∞–∑–∏–Ω</header>
  <div class="tabs" id="categories"></div>
  <div class="container" id="productList"></div>
  <div class="footer">
    <button class="btn" onclick="submitCart()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const products = [
      { name: "–ö–æ–ª—å—Ü–æ –∑–æ–ª–æ—Ç–æ–µ", category: "–ñ–µ–Ω—Å–∫–æ–µ", price: 299, img: "https://cdn-icons-png.flaticon.com/512/6450/6450940.png" },
      { name: "–°–µ—Ä—å–≥–∏ —Å–µ—Ä–µ–±—Ä—è–Ω—ã–µ", category: "–ñ–µ–Ω—Å–∫–æ–µ", price: 179, img: "https://cdn-icons-png.flaticon.com/512/6450/6450899.png" },
      { name: "–ß–∞—Å—ã –º—É–∂—Å–∫–∏–µ", category: "–ú—É–∂—Å–∫–æ–µ", price: 399, img: "https://cdn-icons-png.flaticon.com/512/814/814513.png" },
      { name: "–ö—Ä–æ—Å—Å–æ–≤–∫–∏ Nike", category: "–ú—É–∂—Å–∫–æ–µ", price: 249, img: "https://cdn-icons-png.flaticon.com/512/3661/3661391.png" },
      { name: "–°—É–º–∫–∞ Chanel", category: "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã", price: 319, img: "https://cdn-icons-png.flaticon.com/512/1053/1053244.png" }
    ];

    const cart = [];
    const categories = ["–ñ–µ–Ω—Å–∫–æ–µ", "–ú—É–∂—Å–∫–æ–µ", "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã"];
    let currentCategory = "–ñ–µ–Ω—Å–∫–æ–µ";

    function renderCategories() {
      const catEl = document.getElementById("categories");
      catEl.innerHTML = "";
      categories.forEach(cat => {
        const btn = document.createElement("div");
        btn.className = "tab" + (cat === currentCategory ? " active" : "");
        btn.innerText = cat;
        btn.onclick = () => {
          currentCategory = cat;
          renderCategories();
          renderProducts();
        };
        catEl.appendChild(btn);
      });
    }

    function renderProducts() {
      const container = document.getElementById("productList");
      container.innerHTML = "";
      products.filter(p => p.category === currentCategory).forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <div class="name">${p.name}</div>
          <div class="price">${p.price} z≈Ç</div>
          <button class="btn" onclick='addToCart(${JSON.stringify(p)})'>–î–æ–±–∞–≤–∏—Ç—å</button>
        `;
        container.appendChild(card);
      });
    }

    function addToCart(item) {
      cart.push(item);
      tg.showAlert("–î–æ–±–∞–≤–ª–µ–Ω–æ: " + item.name);
    }

    function submitCart() {
      const user = tg.initDataUnsafe?.user || {};
      fetch('/api/cart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user_id: user.id || null,
          username: user.username || "–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω",
          cart: cart.map(i => `${i.name} (${i.price} z≈Ç)`)
        })
      }).then(() => {
        tg.showAlert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
        cart.length = 0;
      });
    }

    renderCategories();
    renderProducts();
  </script>
</body>
</html>
